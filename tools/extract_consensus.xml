<tool id="extract_consensus" name="extract_consensus" version="1.0">
    <description>Extract consensus sequence from vcf file</description>
    <!-- basic error handling -->
    <stdio>
        <!-- Assume anything other than zero is an error -->
        <exit_code range="1:" level="fatal" description="Tool exception" />
        <exit_code range=":-1" level="fatal" description="Tool exception" />
    </stdio>
    <command>
<![CDATA[
		echo \>$name > $consensus_fasta;
		awk 'BEGIN { OFS="\t" }!/#/{cinit=index($8,"DP="); cend=index($8,";DPR="); $8=substr($8,cinit+3,cend-cinit-3); print $2,$4,$5,$8; }' $input > even1.txt;
		awk '{ while (NR + shift < $1) { print (NR + shift) "\tN\t.\t0"; shift++ }; print }' even1.txt > even2.txt;
		awk -v cutoff="$cutoff" 'BEGIN { OFS="\t" };!/#/{if ($4 < cutoff) print "N",$3; else print $2,$3}' even2.txt > even3.txt;
		awk 'BEGIN { ORS="" };{if ($2==".") print $1; else print substr($2,1,1)}' even3.txt | fold -w 80 >> $consensus_fasta;
]]>
    </command>

    <inputs>
    <param name="name" type="text" value ="consensus" label="sequence name" help="It will appear in the fasta file" />
        <param name="input" format="vcf" type="data" label="input vcf" />
        <param name="cutoff" type="integer" value="100" label="cutoff for base assignment" help="" />
    </inputs>

    <outputs>
        <data format="fasta" name="consensus_fasta" label="consensus fasta" />
    </outputs>
    <help>
**Istituto Superiore di Sanit√†**
Extract consensus sequence from vcf file
    </help>
</tool>
